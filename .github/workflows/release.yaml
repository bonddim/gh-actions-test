---
name: Release

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'version'
        required: true
  push:
    tags:
      - '*'
    # branches:
    #   - 'main'
# env:
#   GIT_TAG: "${GITHUB_REF##*/}"

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: |
          sed -Ei "s/^version: .*/version: ${{ github.event.inputs.version }}/" file
          git config user.name github-actions
          git config user.email github-actions@github.com
          git commit -m "Release ${{ github.event.inputs.version }}" file
          git push origin main:releases

      - uses: marvinpinto/action-automatic-releases@latest  # https://github.com/marketplace/actions/automatic-releases
        with:
          repo_token: '${{ secrets.GITHUB_TOKEN }}'
          automatic_release_tag: ${{ github.event.inputs.version }}
          prerelease: false
          draft: false
